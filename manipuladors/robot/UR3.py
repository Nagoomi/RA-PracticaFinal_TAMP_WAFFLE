import socket
import time

# Dirección IP del robot UR
HOST = "10.10.73.239"

# Puerto del servidor en el robot
PORT = 30002

# Scripts para abrir y cerrar la pinza
Abrir_pinza = 'pinza40UR3.py'
Cerrar_pinza = 'pinza10UR3.py'

# Función para enviar una trayectoria en espacio de configuraciones a la controladora del robot
def send_joint_path(path, sock):
    for joint_config in path:
        print(joint_config)
        sock.send(f"movej({joint_config}, a=0.5, v=0.5)".encode() + "\n".encode())
        time.sleep(3)

# Conexión via socket a la controladora del robot
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((HOST, PORT))

# Trayectoria -- configuraciones (variables articulares, en radianes)
path = [
[2.4883201122283936, -1.4494999647140503, 1.4946999549865723, -1.5383299589157104, -1.5521199703216553, -0.6354740262031555], [2.487790107727051, -1.4159300327301025, 1.5408300161361694, -1.6109399795532227, -1.552940011024475, -0.6374520063400269], [2.4872701168060303, -1.3823599815368652, 1.5869699716567993, -1.6835399866104126, -1.5537500381469727, -0.6394299864768982], [2.4867498874664307, -1.3487900495529175, 1.6331000328063965, -1.7561500072479248, -1.5545599460601807, -0.6414080262184143], [2.4867498874664307, -1.3487900495529175, 1.6331000328063965, -1.7561500072479248, -1.5545599460601807, -0.6414080262184143], [2.487529993057251, -1.3991400003433228, 1.5638999938964844, -1.6472400426864624, -1.553339958190918, -0.6384410262107849], [2.4883201122283936, -1.4494999647140503, 1.4946999549865723, -1.5383299589157104, -1.5521199703216553, -0.6354740262031555], [2.597399950027466, -1.0114200115203857, 0.9960600137710571, -1.6090199947357178, -1.5390299558639526, -0.6274459958076477], [2.5973100662231445, -0.9538220167160034, 0.9978049993515015, -1.6349400281906128, -1.5387699604034424, -0.5885249972343445], [2.597219944000244, -0.8962270021438599, 0.9995499849319458, -1.6608599424362183, -1.5385099649429321, -0.5496039986610413], [2.597399950027466, -1.0114200115203857, 0.9960600137710571, -1.6090199947357178, -1.5390299558639526, -0.6274459958076477], [2.2218000888824463, -1.2095099687576294, 1.1939799785614014, -1.5795199871063232, -1.5690499544143677, -0.8529419898986816], [2.230649948120117, -1.191830039024353, 1.2579799890518188, -1.6520099639892578, -1.5753899812698364, -0.8528839945793152], [2.239490032196045, -1.1741399765014648, 1.321969985961914, -1.7244999408721924, -1.5817300081253052, -0.8528259992599487], [2.2483301162719727, -1.1564600467681885, 1.3859699964523315, -1.7969900369644165, -1.5880800485610962, -0.8527680039405823], [2.2483301162719727, -1.1564600467681885, 1.3859699964523315, -1.7969900369644165, -1.5880800485610962, -0.8527680039405823], [2.235069990158081, -1.182979941368103, 1.28997004032135, -1.6882599592208862, -1.5785599946975708, -0.8528550267219543], [2.2218000888824463, -1.2095099687576294, 1.1939799785614014, -1.5795199871063232, -1.5690499544143677, -0.8529419898986816], [2.4274001121520996, -0.7770209908485413, 0.5014330148696899, -1.3292399644851685, -1.5196599960327148, -0.7429869771003723], [2.4273200035095215, -0.7052879929542542, 0.5015199780464172, -1.352370023727417, -1.5112799406051636, -0.7415030002593994], [2.427229881286621, -0.6335539817810059, 0.5016080141067505, -1.3754899501800537, -1.5029000043869019, -0.7400199770927429], [2.4274001121520996, -0.7770209908485413, 0.5014330148696899, -1.3292399644851685, -1.5196599960327148, -0.7429869771003723]
]


# TRANSIT 
# Se envia la trayectoria a la controladora del robot
send_joint_path(path[:4], sock)
# Enviar archivo script abrir pinza
with open(Cerrar_pinza, 'rb') as f: sock.sendall(f.read())
time.sleep(1)

# TRANSFER 
# Se envia la trayectoria a la controladora del robot
send_joint_path(path[4:9], sock)
# Enviar archivo script cerrar pinza
with open(Abrir_pinza, 'rb') as f: sock.sendall(f.read())
time.sleep(1)

# TRANSIT 
# Se envia la trayectoria a la controladora del robot
send_joint_path(path[9:11], sock)

# TRANSIT 
# Se envia la trayectoria a la controladora del robot
send_joint_path(path[11:15], sock)
# Enviar archivo script abrir pinza
with open(Cerrar_pinza, 'rb') as f: sock.sendall(f.read())
time.sleep(1)

# TRANSFER 
# Se envia la trayectoria a la controladora del robot
send_joint_path(path[15:20], sock)
# Enviar archivo script cerrar pinza
with open(Abrir_pinza, 'rb') as f: sock.sendall(f.read())
time.sleep(1)

# TRANSIT 
# Se envia la trayectoria a la controladora del robot
send_joint_path(path[20:22], sock)


# Mensaje que se imprime cuando se finaliza la ejecución
# de la trayectoria
print("Trayectoria finalizada")

data = sock.recv(1024)

# Se cierra la conexión
sock.close()
